// /js/admin_site_editor_v58.js
import supabase from "./supabase_client_v58.js";import { requireSession, wireSignOut } from "./auth_guard_v58.js";
await requireSession("admin");wireSignOut();
document.getElementById("btnOpenChat")?.addEventListener("click",()=>window.ClarionChat?.open());
document.getElementById("tabSiteEditor")?.addEventListener("click",()=>{for(const id of ["paneApplicants","paneOrders","paneHours","paneGPS","paneHealth","paneSiteEditor"]){const el=document.getElementById(id);if(!el)continue;el.style.display=(id==="paneSiteEditor")?"block":"none";}});
const pairs=[["home_top_left_card_html","sc_home_top_left_card"],["home_logo_card_html","sc_home_logo_card"],["home_wide_banner_html","sc_home_wide_banner"],["home_row3_left_html","sc_home_row3_left"],["home_row3_center_html","sc_home_row3_center"],["home_row3_right_html","sc_home_row3_right"],["about_main_html","sc_about_main"],["services_main_html","sc_services_main"],["faq_main_html","sc_faq_main"]];
async function loadSiteContent(){const {data,error}=await supabase.from("site_content").select("key, content").in("key",pairs.map(p=>p[0]));if(error){alert(error.message);return}const map=new Map((data||[]).map(r=>[r.key,r.content]));for(const [key,taId] of pairs){const ta=document.getElementById(taId);if(!ta)continue;let val=map.get(key)||"";if(val&&typeof val!=="string"){try{val=String(val)}catch{val=""}}ta.value=val;}}async function saveSiteContent(){const rows=pairs.map(([key,taId])=>{const ta=document.getElementById(taId);return {key,content:(ta?.value??""),published:true};});const {error}=await supabase.from("site_content").upsert(rows,{onConflict:"key"});if(error)alert(error.message);else alert("Saved. Public pages refresh to show updates.");}
document.getElementById("btnReloadSiteContent")?.addEventListener("click",loadSiteContent);document.getElementById("btnSaveSiteContent")?.addEventListener("click",saveSiteContent);loadSiteContent();